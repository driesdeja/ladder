{% extends 'players/base.html' %}

{% block content %}
    <div class="container">
        <ul class="progressbar">
            <li><a href="{% url 'ladder-detail' ladder_round.ladder.id %}">Create Round</a></li>
            <li><a href="{% url 'manage-players-in-round' %}?round={{ ladder_round.id }}">Add Players to round</a></li>
            <li><a href="{% url 'round-draw' ladder_round.id %}">Finalise Draw</a></li>
            <li class="active">Capture Results</li>
        </ul>
    </div>

    {% csrf_token %}
    <p>Capture Results for Ladder round : {{ ladder_round.start_date }}</p>

    <div class="draw-container">
        {% if messages %}
            <ul class="messages">
                {% for message in messages %}
                    <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
                {% endfor %}
            </ul>
        {% endif %}
        <form method="post" action="{% url 'capture-results' ladder_round.id %}">
        {% csrf_token %}
            <table class="table text-center">
                <thead>
                <tr>
                    <th class="text-center">Player 1</th>
                    <th>Games for Player 1</th>
                    <th>Player 1 defaulted</th>
                    <th></th>
                    <th class="text-center">Player 2</th>
                    <th>Games for Player 2</th>
                    <th>Player2 defaulted</th>
                    <th>Game Cancelled</th>
                    <th>Submit</th>
                </tr>
                </thead>
                <tbody>

                <input type="hidden" name="number-of-matches" value="{{ matches|length }}"/>
                {% for match in matches %}

                    <tr>
                        <input type="hidden" name="match" value="{{ match.id }}"/>
                        <td>{{ match.player1.first_name }} {{ match.player1.last_name }} ({{ match.player1.ranking }})
                        </td>
                        <td>
                            {% if match.result == match.NOT_PLAYED %}
                                <input type="text" name="match[{{ match.id }}][player1-games]"/>
                            {% else %}
                                {{ match.games_for_player1 }}
                            {% endif %}
                        </td>
                        <td>
                            {% if match.result == match.PLAYER_1_DEFAULTED %}
                                {{ match.player1.first_name }} {{ match.player1.last_name }} Defaulted
                            {% elif match.result == match.NOT_PLAYED %}
                                <input type="checkbox" name="match[{{ match.id }}][player1-defaulted]">
                            {% elif match.result == match.PLAYER_1_DEFAULTED %}
                                <input type="checkbox" checked readonly/>
                            {% endif %}
                        </td>
                        <td>VS</td>
                        <td>{{ match.player2.first_name }} {{ match.player2.last_name }} ({{ match.player2.ranking }})
                        </td>
                        <td>
                            {% if match.result == match.NOT_PLAYED %}
                                <input type="text" name="match[{{ match.id }}][player2-games]"/>
                            {% else %}
                                {{ match.games_for_player2 }}
                            {% endif %}
                        </td>
                       <td>
                            {% if match.result == match.PLAYER_2_DEFAULTED %}
                                {{ match.player2.first_name }} {{ match.player2.last_name }} Defaulted
                            {% elif match.result == match.NOT_PLAYED %}
                                <input type="checkbox" name="match[{{ match.id }}][player2-defaulted]">
                            {% elif match.result == match.PLAYER_2_DEFAULTED %}
                                <input type="checkbox" checked readonly/>
                            {% endif %}
                        </td>
                        <td>{% if match.result == match.CANCELLED %}
                                <input type="checkbox" checked readonly/>
                            {% elif match.result != match.NOT_PLAYED %}

                            {% else %}
                                <input type="checkbox" name="match[{{ match.id }}][match-cancelled]">
                            {% endif %}
                        </td>
                        <td>
                            {% if match.result != match.NOT_PLAYED %}
                                <a href="{% url 'edit-match' match.id %}">Edit</a>
                            {% endif %}
                        </td>
                    </tr>


                {% endfor matches %}

                </tbody>
            </table>
            <input type="submit" value="Capture">
        </form>
    </div>
{% endblock content %}